<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Professor | SED Santa Branca</title>
    <link href="css/professor.css" rel="stylesheet"/>
    
    <!-- ESTILOS PARA O DI√ÅRIO DE CLASSE -->
    <style>
        .turmas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .turma-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .turma-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .turma-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .turma-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.2em;
        }

        .turma-periodo {
            background: #ecf0f1;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .turma-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .turma-stats span {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .turma-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s;
            flex: 1;
            min-width: 100px;
        }

        .btn-action:hover {
            background: #2980b9;
        }

        .campo-nota {
            width: 80px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .media-aluno {
            font-weight: bold;
            color: #2c3e50;
        }

        .situacao-aluno {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }
    </style>
    
    <!-- ‚úÖ guard.js -->
    <script src="js/guard.js"></script>
    <!-- ‚úÖ Prote√ß√£o -->
    <script>SEDSME.requirePerfil("professor");</script>
</head>
<body>
    <div class="sidebar">
        <div class="logo-area">
            <img alt="Logo Santa Branca" class="logo" src="../img/Santa Branca Logo.png"/>
            <h2>Portal do Professor</h2>
        </div>
        
        <div class="user-info">
            <div class="user-avatar">üë®‚Äçüè´</div>
            <div class="user-details">
                <strong id="userName">Carregando...</strong>
                <span id="userProfile">Professor</span>
                <span id="userSchool" style="display:block; font-size:12px; color:#666;"></span>
            </div>
        </div>
        
        <div class="menu">
            <div class="menu-item active" onclick="navegar('dashboard')">
                <div class="icon"><span>üìä</span></div>
                P√°gina Principal
            </div>
            <div class="menu-item" onclick="navegar('diario')">
                <div class="icon"><span>üìò</span></div>
                Di√°rio de Classe
                <span class="info-badge" id="badge-diario">0</span>
            </div>
            <div class="menu-item" onclick="navegar('hora-atividade')">
                <div class="icon"><span>‚è±Ô∏è</span></div>
                Hora Atividade - H.A
                <span class="info-badge" id="badge-ha">0</span>
            </div>
            <div class="menu-item" onclick="navegar('atividades')">
                <div class="icon"><span>üìù</span></div>
                Atividades e Avalia√ß√µes
                <span class="info-badge" id="badge-atividades">0</span>
            </div>
            <div class="menu-item" onclick="navegar('plano-ensino')">
                <div class="icon"><span>üìö</span></div>
                Plano de Ensino
            </div>
            <div class="menu-item sair" onclick="sair()">
                <div class="icon"><span>üö™</span></div>
                Sair do Sistema
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="header-left">
                <span id="pageTitle">P√°gina Principal do Professor</span>
            </div>
            <div class="header-right">
                <span id="currentDate"></span>
            </div>
        </div>
        
        <div class="content" id="contentArea">
            <!-- DASHBOARD -->
            <div class="page-content active" id="dashboard-content">
                <div class="welcome-card">
                    <h2>Bem-vindo(a), <span id="welcomeName">Professor(a)</span>!</h2>
                    <p>Selecione um m√≥dulo no menu para gerenciar suas atividades acad√™micas.</p>
                </div>
                
                <!-- Turmas atribu√≠das -->
                <div class="card">
                    <h3>Minhas Turmas Atribu√≠das</h3>
                    <div class="sb-msg" id="sbTurmasMsg"></div>
                    <div class="turmas-grid" id="sbTurmasList">
                        <!-- Turmas ser√£o carregadas dinamicamente -->
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìò</div>
                        <div class="stat-info">
                            <h3 id="totalDiarios">0</h3>
                            <p>Di√°rios em Aberto</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-info">
                            <h3 id="totalHA">0</h3>
                            <p>Horas Atividade</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <h3 id="totalAtividades">0</h3>
                            <p>Atividades Criadas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <h3 id="totalEstudantes">0</h3>
                            <p>Estudantes</p>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h3>Acesso R√°pido</h3>
                    <div class="actions-grid">
                        <div class="action-card" onclick="navegar('diario')">
                            <div class="action-icon">üìò</div>
                            <span>Di√°rio de Classe</span>
                        </div>
                        <div class="action-card" onclick="navegar('hora-atividade')">
                            <div class="action-icon">‚è±Ô∏è</div>
                            <span>Hora Atividade</span>
                        </div>
                        <div class="action-card" onclick="navegar('atividades')">
                            <div class="action-icon">üìù</div>
                            <span>Criar Atividade</span>
                        </div>
                        <div class="action-card" onclick="navegar('plano-ensino')">
                            <div class="action-icon">üìö</div>
                            <span>Plano de Ensino</span>
                        </div>
                    </div>
                </div>
                
                <div class="recent-tasks">
                    <h3>Pr√≥ximas Atividades</h3>
                    <div class="tasks-container" id="tasksList">
                        <!-- Atividades ser√£o carregadas dinamicamente -->
                    </div>
                </div>
            </div>
            
            <!-- DI√ÅRIO DE CLASSE -->
            <div class="page-content" id="diario-content">
                <div class="module-header">
                    <h2>üìò Di√°rio de Classe</h2>
                    <p>Gerencie as atividades de cada turma</p>
                </div>

                <div class="filters-bar">
                    <label>
                        <span>Filtrar por escola</span>
                        <select id="filtroEscola">
                            <option value="">Todas</option>
                        </select>
                    </label>

                    <label>
                        <span>Filtrar por turma</span>
                        <select id="filtroTurma">
                            <option value="">Todas</option>
                        </select>
                    </label>

                    <button class="btn-action" id="btnLimparFiltros" type="button">Limpar</button>
                </div>

                <!-- Cards das Turmas -->
                <div class="turmas-grid" id="turmas-container">
                    <!-- Cards ser√£o carregados dinamicamente -->
                </div>
                
                <!-- Modal para Registro de Chamada -->
                <div class="modal" id="modal-chamada">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h3>üìã Registro de Chamada</h3>
                            <span class="close" onclick="fecharModal('modal-chamada')">√ó</span>
                        </div>
                        <div class="modal-body">
                            <div class="chamada-header">
                                <h4 id="chamada-turma-titulo">Turma: Carregando...</h4>
                                <div class="data-controle">
                                    <label for="dataChamada">Data:</label>
                                    <input id="dataChamada" type="date"/>
                                    <button class="btn-secondary" onclick="usarDataHoje('dataChamada')">Hoje</button>
                                </div>
                            </div>
                            <div class="tabela-container">
                                <table id="tabela-chamada">
                                    <thead>
                                        <tr>
                                            <th width="60">N¬∫</th>
                                            <th>Estudante</th>
                                            <th width="150">Situa√ß√£o</th>
                                            <th width="200">Justificativa</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corpo-chamada">
                                        <!-- Dados ser√£o carregados dinamicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="fecharModal('modal-chamada')" type="button">
                                ‚ùå Cancelar
                            </button>
                            <button class="btn-secondary" onclick="exportarCSVChamada()" type="button">‚¨áÔ∏è CSV</button>
                            <button class="btn-secondary" onclick="exportarPDFChamada()" type="button">‚¨áÔ∏è PDF</button>
                            <button class="btn-primary" onclick="salvarChamada()" type="button">
                                üíæ Salvar Chamada
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Modal para Registro de Conte√∫do -->
                <div class="modal" id="modal-conteudo">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h3>üìö Registro de Conte√∫do</h3>
                            <span class="close" onclick="fecharModal('modal-conteudo')">√ó</span>
                        </div>
                        <div class="modal-body">
                            <form id="form-conteudo">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="dataAula">Data da Aula *</label>
                                        <input id="dataAula" required type="date"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="bimestreConteudo">Bimestre *</label>
                                        <select id="bimestreConteudo" required>
                                            <option value="1">1¬∫ Bimestre</option>
                                            <option value="2">2¬∫ Bimestre</option>
                                            <option value="3">3¬∫ Bimestre</option>
                                            <option value="4">4¬∫ Bimestre</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="conteudoAula">Conte√∫do da Aula *</label>
                                    <textarea id="conteudoAula" placeholder="Descreva o conte√∫do ministrado na aula..." required rows="4"></textarea>
                                </div>

                            <div class="form-group">
                                <label for="atividadeAula">Atividade</label>
                                <input type="text" id="atividadeAula" placeholder="Ex.: Produ√ß√£o de texto / Exerc√≠cios" required />
                            </div>
                                <div class="form-group">
                                    <label for="habilidadeBNCC">Habilidade da BNCC *</label>
                                    <select id="habilidadeBNCC" required>
                                        <option value="">Selecione uma habilidade</option>
                                        <option value="EF06MA01">EF06MA01 - Resolver problemas com n√∫meros naturais</option>
                                        <option value="EF06MA02">EF06MA02 - Reconhecer sistema de numera√ß√£o decimal</option>
                                        <option value="EF06MA03">EF06MA03 - Resolver problemas com fra√ß√µes</option>
                                        <option value="EF07MA01">EF07MA01 - Resolver problemas com n√∫meros inteiros</option>
                                        <option value="EF07MA02">EF07MA02 - Opera√ß√µes com n√∫meros racionais</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="objetoConhecimento">Objeto de Conhecimento *</label>
                                    <input id="objetoConhecimento" placeholder="Ex: N√∫meros naturais, Fra√ß√µes, Geometria..." required type="text"/>
                                </div>
                                <div class="form-group">
                                    <label for="observacoesAula">Observa√ß√µes</label>
                                    <textarea id="observacoesAula" placeholder="Observa√ß√µes adicionais sobre a aula..." rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="fecharModal('modal-conteudo')" type="button">
                                ‚ùå Cancelar
                            </button>
                            <button class="btn-primary" onclick="exportarCSVConteudo()" type="button">‚¨áÔ∏è CSV</button>
                            <button class="btn-secondary" onclick="exportarPDFConteudo()" type="button">‚¨áÔ∏è PDF</button>
                            <button class="btn-primary" onclick="salvarConteudo()" type="button">
                                üíæ Salvar Conte√∫do
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- OUTROS M√ìDULOS (HORA ATIVIDADE, ATIVIDADES, PLANO DE ENSINO) -->
            <!-- ... (mantenha o resto do c√≥digo como est√°) ... -->
            
        </div>
    </div>

    <script src="/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="js/supabaseClient.js"></script>
    <script src="js/professor.js"></script>
    
    <script>
        // Fun√ß√µes b√°sicas de navega√ß√£o
        function navegar(pagina) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');

            document.querySelectorAll('.page-content').forEach(content => content.classList.remove('active'));
            const targetPage = document.getElementById(pagina + '-content');
            if (targetPage) targetPage.classList.add('active');

            const pageTitles = {
                'dashboard': 'P√°gina Principal do Professor',
                'diario': 'Di√°rio de Classe',
                'hora-atividade': 'Hora Atividade',
                'atividades': 'Atividades e Avalia√ß√µes',
                'plano-ensino': 'Plano de Ensino'
            };
            document.getElementById('pageTitle').textContent = pageTitles[pagina] || 'Portal do Professor';
        }

        function fecharModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
        }

        function usarDataHoje(campoId) {
            const campo = document.getElementById(campoId);
            if (campo) {
                const hoje = new Date().toISOString().split('T')[0];
                campo.value = hoje;
            }
        }

        // Inicializa√ß√£o b√°sica
        document.addEventListener('DOMContentLoaded', function() {
            // Atualizar data atual
            const dataAtual = new Date();
            const opcoes = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = dataAtual.toLocaleDateString('pt-BR', opcoes);
            
            // Verificar se h√° fun√ß√µes de inicializa√ß√£o do professor.js
            if (window.initProfessor) {
                window.initProfessor();
            }
        });
    </script>

    <!-- Modal Notas (Boletim por Turma) -->
    <div id="modal-notas" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 1100px;">
            <div class="modal-header">
                <h3>üìù Registro de Notas</h3>
                <span class="close" onclick="fecharModal('modal-notas')">&times;</span>
            </div>

            <div class="modal-body">
                <p><strong>Turma:</strong> <span id="notas-turma-titulo">-</span></p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="notasBimestre">Bimestre</label>
                        <select id="notasBimestre">
                            <option value="1¬∫ Bimestre">1¬∫ Bimestre</option>
                            <option value="2¬∫ Bimestre">2¬∫ Bimestre</option>
                            <option value="3¬∫ Bimestre">3¬∫ Bimestre</option>
                            <option value="4¬∫ Bimestre">4¬∫ Bimestre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Atividades</label>
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <button class="btn-secondary" type="button" onclick="adicionarColunaAtividade()">‚ûï Adicionar atividade</button>
                            <button class="btn-secondary" type="button" onclick="removerUltimaAtividade()">‚ûñ Remover √∫ltima</button>
                        </div>
                        <small style="display:block; color:#666; margin-top:6px;">Digite o nome da atividade no cabe√ßalho da coluna. A m√©dia √© calculada automaticamente.</small>
                    </div>
                </div>

                <div style="overflow:auto; max-height: 440px; border:1px solid #e5e7eb; border-radius:10px;">
                    <table class="table" style="width:100%; min-width: 900px;">
                        <thead id="thead-notas-gradebook"></thead>
                        <tbody id="tbody-notas-gradebook"></tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="exportarCSVNotasGradebook()" type="button">‚¨áÔ∏è CSV</button>
                <button class="btn-secondary" onclick="exportarPDFNotasGradebook()" type="button">‚¨áÔ∏è PDF</button>
                <button class="btn-primary" onclick="salvarNotasGradebook()" type="button">üíæ Salvar Notas</button>
                <button class="btn-secondary" onclick="fecharModal('modal-notas')" type="button">Fechar</button>
            </div>
        </div>
    </div>

</body>
</html>